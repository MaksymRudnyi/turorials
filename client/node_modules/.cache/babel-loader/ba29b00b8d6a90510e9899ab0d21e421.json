{"ast":null,"code":"const express = require('express');\n\nconst multer = require('multer');\n\nconst cors = require('cors');\n\nconst fs = require('fs');\n\nvar nodePandoc = require('node-pandoc');\n\nconst app = express();\n/*\r\napp.use(express.static('public'));\r\n*/\n\napp.use(cors());\n/*const deleteFile = async (filePath) => {\r\n    try {\r\n      await fsPromises.unlink(filePath);\r\n      console.log('Successfully removed file!');\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n//deleteFile('../server3/markdown.md');\r\n*/\n//-------------UPLOAD OF THE DOCUMENT -------//\n\nexport const storage = multer.diskStorage({\n  destination: (req, file, cb) => {\n    cb(null, 'public');\n  },\n  filename: (req, file, cb) => {\n    cb(null, \"markdown.docx\");\n  }\n});\nconst upload = multer({\n  storage\n}).single('file'); /////-------------CONVERSION OF THE DOCX - PANDOC ------////////\n\nvar src, args, callback;\nsrc = \"./public/markdown.docx\"; // Arguments can be either a single string:\n\nargs = '-f docx -t markdown -o ./markdown.md'; // Or in an array of strings -- careful no spaces are present:\n\nargs = ['-f', 'docx', '-t', 'markdown', '-o', 'markdown.md']; // Set your callback function\n\ncallback = function (err, result) {\n  if (err) {\n    console.error('Oh Nos: ', err);\n  } // For output to files, the 'result' will be a boolean 'true'.\n  // Otherwise, the converted value will be returned.\n\n\n  console.log(result);\n  return result;\n}; //--------------API-----------------------//\n\n\napp.post('/upload', (req, res) => {\n  //  deleteFile(\"../../../fileupload8/server/markdown.md\")\n  upload(req, res, err => {\n    if (err) {\n      return res.status(500).json(err);\n    } else {\n      function send() {\n        res.status(200).send(req.file), fs.copyFile('./public/markdown.docx', './markdown.docx', err => {\n          if (err) throw err;\n          console.log('error');\n        });\n      }\n    }\n\n    return send();\n  });\n  nodePandoc(src, args, callback);\n});\napp.listen(8000, () => {\n  console.log('App is running on port 8000');\n});","map":{"version":3,"names":["express","require","multer","cors","fs","nodePandoc","app","use","storage","diskStorage","destination","req","file","cb","filename","upload","single","src","args","callback","err","result","console","error","log","post","res","status","json","send","copyFile","listen"],"sources":["C:/Users/apinto2/Desktop/teswordtomd/12 setembro/UPLOAD 9/turorials/server/server.js"],"sourcesContent":["const express = require('express');\r\nconst multer = require('multer');\r\nconst cors = require('cors');\r\nconst fs = require('fs');\r\n\r\nvar nodePandoc = require('node-pandoc');\r\n\r\nconst app = express();\r\n/*\r\napp.use(express.static('public'));\r\n*/\r\napp.use(cors());\r\n\r\n\r\n\r\n/*const deleteFile = async (filePath) => {\r\n    try {\r\n      await fsPromises.unlink(filePath);\r\n      console.log('Successfully removed file!');\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n//deleteFile('../server3/markdown.md');\r\n*/\r\n\r\n//-------------UPLOAD OF THE DOCUMENT -------//\r\nexport const storage = multer.diskStorage({\r\n    destination: (req, file, cb) => {\r\n        cb(null, 'public')\r\n    },\r\n    filename:(req, file, cb) => {\r\n        cb(null, \"markdown.docx\")\r\n    }\r\n});\r\n\r\nconst upload = multer({storage}).single('file')\r\n\r\n/////-------------CONVERSION OF THE DOCX - PANDOC ------////////\r\n\r\nvar src, args, callback;\r\n \r\nsrc = (\"./public/markdown.docx\");\r\n \r\n// Arguments can be either a single string:\r\nargs = '-f docx -t markdown -o ./markdown.md';\r\n// Or in an array of strings -- careful no spaces are present:\r\nargs = ['-f','docx','-t','markdown','-o','markdown.md'];\r\n\r\n// Set your callback function\r\ncallback = function (err, result) {\r\n \r\n  if (err) {\r\n    console.error('Oh Nos: ',err);\r\n  }\r\n \r\n  // For output to files, the 'result' will be a boolean 'true'.\r\n  // Otherwise, the converted value will be returned.\r\n  console.log(result);\r\n  return result;\r\n};\r\n \r\n\r\n//--------------API-----------------------//\r\n\r\napp.post('/upload', (req, res) => {\r\n    //  deleteFile(\"../../../fileupload8/server/markdown.md\")\r\n    upload(req,res, (err) => {\r\n        if (err) {\r\n            return res.status(500).json(err)\r\n        }else{\r\n            function send(){\r\n                res.status(200).send(req.file),\r\n                fs.copyFile('./public/markdown.docx', './markdown.docx', \r\n                (err) => { \r\n                    if (err) throw err;\r\n                    console.log('error');\r\n                  }); \r\n            }\r\n        }\r\n        \r\n        return send();\r\n    })\r\n\r\n    nodePandoc(src, args, callback);\r\n});\r\n\r\n\r\n\r\napp.listen(8000, () => {\r\n    console.log('App is running on port 8000')\r\n});\r\n\r\n"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAME,IAAI,GAAGF,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMG,EAAE,GAAGH,OAAO,CAAC,IAAD,CAAlB;;AAEA,IAAII,UAAU,GAAGJ,OAAO,CAAC,aAAD,CAAxB;;AAEA,MAAMK,GAAG,GAAGN,OAAO,EAAnB;AACA;AACA;AACA;;AACAM,GAAG,CAACC,GAAJ,CAAQJ,IAAI,EAAZ;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA,OAAO,MAAMK,OAAO,GAAGN,MAAM,CAACO,WAAP,CAAmB;EACtCC,WAAW,EAAE,CAACC,GAAD,EAAMC,IAAN,EAAYC,EAAZ,KAAmB;IAC5BA,EAAE,CAAC,IAAD,EAAO,QAAP,CAAF;EACH,CAHqC;EAItCC,QAAQ,EAAC,CAACH,GAAD,EAAMC,IAAN,EAAYC,EAAZ,KAAmB;IACxBA,EAAE,CAAC,IAAD,EAAO,eAAP,CAAF;EACH;AANqC,CAAnB,CAAhB;AASP,MAAME,MAAM,GAAGb,MAAM,CAAC;EAACM;AAAD,CAAD,CAAN,CAAkBQ,MAAlB,CAAyB,MAAzB,CAAf,C,CAEA;;AAEA,IAAIC,GAAJ,EAASC,IAAT,EAAeC,QAAf;AAEAF,GAAG,GAAI,wBAAP,C,CAEA;;AACAC,IAAI,GAAG,sCAAP,C,CACA;;AACAA,IAAI,GAAG,CAAC,IAAD,EAAM,MAAN,EAAa,IAAb,EAAkB,UAAlB,EAA6B,IAA7B,EAAkC,aAAlC,CAAP,C,CAEA;;AACAC,QAAQ,GAAG,UAAUC,GAAV,EAAeC,MAAf,EAAuB;EAEhC,IAAID,GAAJ,EAAS;IACPE,OAAO,CAACC,KAAR,CAAc,UAAd,EAAyBH,GAAzB;EACD,CAJ+B,CAMhC;EACA;;;EACAE,OAAO,CAACE,GAAR,CAAYH,MAAZ;EACA,OAAOA,MAAP;AACD,CAVD,C,CAaA;;;AAEAf,GAAG,CAACmB,IAAJ,CAAS,SAAT,EAAoB,CAACd,GAAD,EAAMe,GAAN,KAAc;EAC9B;EACAX,MAAM,CAACJ,GAAD,EAAKe,GAAL,EAAWN,GAAD,IAAS;IACrB,IAAIA,GAAJ,EAAS;MACL,OAAOM,GAAG,CAACC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBR,GAArB,CAAP;IACH,CAFD,MAEK;MACD,SAASS,IAAT,GAAe;QACXH,GAAG,CAACC,MAAJ,CAAW,GAAX,EAAgBE,IAAhB,CAAqBlB,GAAG,CAACC,IAAzB,GACAR,EAAE,CAAC0B,QAAH,CAAY,wBAAZ,EAAsC,iBAAtC,EACCV,GAAD,IAAS;UACL,IAAIA,GAAJ,EAAS,MAAMA,GAAN;UACTE,OAAO,CAACE,GAAR,CAAY,OAAZ;QACD,CAJH,CADA;MAMH;IACJ;;IAED,OAAOK,IAAI,EAAX;EACH,CAfK,CAAN;EAiBAxB,UAAU,CAACY,GAAD,EAAMC,IAAN,EAAYC,QAAZ,CAAV;AACH,CApBD;AAwBAb,GAAG,CAACyB,MAAJ,CAAW,IAAX,EAAiB,MAAM;EACnBT,OAAO,CAACE,GAAR,CAAY,6BAAZ;AACH,CAFD"},"metadata":{},"sourceType":"module"}